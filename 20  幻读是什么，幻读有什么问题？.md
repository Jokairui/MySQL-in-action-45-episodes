### Cue

幻读的定义

幻读带来的问题

间隙锁解决了什么问题

间隙锁的作用区间

next-key lock的定义

### Notes

#### 关于幻读

1. 在可重复读隔离级别下，普通的查询是快照读，是不会看到别的事务插入的数据的。因此，幻读在“当前读”下才会出现。
2. select 语句用“当前读”看到，不能称为幻读。幻读仅专指“新插入的行”。

#### 幻读带来的问题

1. 锁的语义被破坏
2. 数据一致性问题，binlog与真正的语句执行结果不一致

#### 间隙锁

给所有扫描到的行之间的间隙，以及最小行到无穷小、最大行到无穷大这两个间隙，加锁

间隙锁和间隙锁之间不会冲突，间隙锁的意义仅仅是**防止其它事务往对于间隙插入这一动作**

但是对于极端情况下，session a和b给同样的间隙分别加上了锁，同时

session a和b都在各自的事务中往间隙锁中间插入值，就会导致死锁

#### next-key lock

间隙锁加上它数轴右边的行锁形成的左开右闭的区间，就称为next-key lock



### Summary

理解了幻读的定义与幻读带来的问题，理解了间隙锁产生的原因，以及它的作用范围，了解了next-key lock的定义